<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Rustc internal tooling for hand-writing MIR."><meta name="keywords" content="rust, rustlang, rust-lang, mir"><title>std::intrinsics::mir - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-9e1e072012b612f8.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../../../static.files/light-1469fca9efc07bcb.css"><link rel="stylesheet" disabled href="../../../static.files/dark-e9b7e5d8ba0dc980.css"><link rel="stylesheet" disabled href="../../../static.files/ayu-0c1cf144240c9f40.css"><script id="default-settings" ></script><script src="../../../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="../../../static.files/main-2da75ee0e1909b3a.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../std/index.html"><div class="logo-container"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../../std/index.html"><div class="logo-container"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2 class="location"><a href="#">Module mir</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‚ÄòS‚Äô to search, ‚Äò?‚Äô for more options‚Ä¶" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Module <a href="../../index.html">std</a>::<wbr><a href="../index.html">intrinsics</a>::<wbr><a class="mod" href="#">mir</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/core/intrinsics.rs.html#63">source</a> ¬∑ <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><span class="item-info"><div class="stab unstable"><span class="emoji">üî¨</span><span>This is a nightly-only experimental API. (<code>custom_mir</code>)</span></div></span><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Rustc internal tooling for hand-writing MIR.</p>
<p>If for some reasons you are not writing rustc tests and have found yourself considering using
this feature, turn back. This is <em>exceptionally</em> unstable. There is no attempt at all to make
anything work besides those things which the rustc test suite happened to need. If you make a
typo you‚Äôll probably ICE. Really, this is not the solution to your problems. Consider instead
supporting the <a href="https://github.com/rust-lang/project-stable-mir">stable MIR project group</a>.</p>
<p>The documentation for this module describes how to use this feature. If you are interested in
hacking on the implementation, most of that documentation lives at
<code>rustc_mir_building/src/build/custom/mod.rs</code>.</p>
<p>Typical usage will look like this:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#![feature(core_intrinsics, custom_mir)]

</span><span class="kw">extern crate </span>core;
<span class="kw">use </span>core::intrinsics::mir::<span class="kw-2">*</span>;

<span class="attr">#[custom_mir(dialect = <span class="string">&quot;built&quot;</span>)]
</span><span class="kw">pub fn </span>simple(x: i32) -&gt; i32 {
    <span class="macro">mir!</span>(
        <span class="kw">let </span>temp1: i32;
        <span class="kw">let </span>temp2: <span class="kw">_</span>;

        {
            temp1 = x;
            Goto(exit)
        }

        exit = {
            temp2 = Move(temp1);
            RET = temp2;
            Return()
        }
    )
}</code></pre><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Ballow(unused)%5D%0A%23!%5Bfeature(core_intrinsics%2C%20custom_mir)%5D%0A%0Aextern%20crate%20core%3B%0Afn%20main()%20%7B%0Ause%20core%3A%3Aintrinsics%3A%3Amir%3A%3A*%3B%0A%0A%23%5Bcustom_mir(dialect%20%3D%20%22built%22)%5D%0Apub%20fn%20simple(x%3A%20i32)%20-%3E%20i32%20%7B%0A%20%20%20%20mir!(%0A%20%20%20%20%20%20%20%20let%20temp1%3A%20i32%3B%0A%20%20%20%20%20%20%20%20let%20temp2%3A%20_%3B%0A%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20temp1%20%3D%20x%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20Goto(exit)%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20exit%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20temp2%20%3D%20Move(temp1)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20RET%20%3D%20temp2%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20Return()%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20)%0A%7D%0A%7D&amp;version=nightly&amp;edition=2021">Run</a></div>
<p>Hopefully most of this is fairly self-explanatory. Expanding on some notable details:</p>
<ul>
<li>The <code>custom_mir</code> attribute tells the compiler to treat the function as being custom MIR. This
attribute only works on functions - there is no way to insert custom MIR into the middle of
another function.</li>
<li>The <code>dialect</code> and <code>phase</code> parameters indicate which version of MIR you are inserting here.
This will normally be the phase that corresponds to the thing you are trying to test. The
phase can be omitted for dialects that have just one.</li>
<li>You should define your function signature like you normally would. Externally, this function
can be called like any other function.</li>
<li>Type inference works - you don‚Äôt have to spell out the type of all of your locals.</li>
</ul>
<p>For now, all statements and terminators are parsed from nested invocations of the special
functions provided in this module. We additionally want to (but do not yet) support more
‚Äúnormal‚Äù Rust syntax in places where it makes sense. Also, most kinds of instructions are not
supported yet.</p>
</div></details><h2 id="macros" class="small-section-header"><a href="#macros">Macros</a></h2><div class="item-table"><div class="item-row"><div class="item-left unstable module-item"><a class="macro" href="macro.mir.html" title="std::intrinsics::mir::mir macro">mir</a><span class="stab unstable" title="">Experimental</span></div><div class="item-right docblock-short">Convenience macro for generating custom MIR.</div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left unstable module-item"><a class="struct" href="struct.BasicBlock.html" title="std::intrinsics::mir::BasicBlock struct">BasicBlock</a><span class="stab unstable" title="">Experimental</span></div><div class="item-right docblock-short">Type representing basic blocks.</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><div class="item-table"><div class="item-row"><div class="item-left unstable module-item"><a class="fn" href="fn.Goto.html" title="std::intrinsics::mir::Goto fn">Goto</a><span class="stab unstable" title="">Experimental</span></div></div><div class="item-row"><div class="item-left unstable module-item"><a class="fn" href="fn.Move.html" title="std::intrinsics::mir::Move fn">Move</a><span class="stab unstable" title="">Experimental</span></div></div><div class="item-row"><div class="item-left unstable module-item"><a class="fn" href="fn.Retag.html" title="std::intrinsics::mir::Retag fn">Retag</a><span class="stab unstable" title="">Experimental</span></div></div><div class="item-row"><div class="item-left unstable module-item"><a class="fn" href="fn.RetagRaw.html" title="std::intrinsics::mir::RetagRaw fn">RetagRaw</a><span class="stab unstable" title="">Experimental</span></div></div><div class="item-row"><div class="item-left unstable module-item"><a class="fn" href="fn.Return.html" title="std::intrinsics::mir::Return fn">Return</a><span class="stab unstable" title="">Experimental</span></div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="std" data-themes="" data-resource-suffix="1.67.0" data-rustdoc-version="1.67.0-dev" data-search-js="search-df80cc3cb87b6482.js" data-settings-js="settings-7873449fa8c00e11.js" data-settings-css="settings-af96d9e2fc13e081.css" ></div></body></html>